{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { getFileSizeAndUnit, isEmpty } from '@utils/helpers';\nimport React, { useState, useEffect, useRef } from 'react';\nimport { toast as toaster } from 'react-toastify';\nvar initialState = {\n  files: [],\n  events: [],\n  filePreviews: {},\n  uploading: false,\n  selectedFile: null,\n  loaded: 0,\n  error: '',\n  warning: '',\n  content: ''\n};\nexport default function UploadComponent(_ref) {\n  var _ref$autoUpload = _ref.autoUpload,\n      autoUpload = _ref$autoUpload === void 0 ? true : _ref$autoUpload,\n      _ref$allowedExtension = _ref.allowedExtensions,\n      allowedExtensions = _ref$allowedExtension === void 0 ? ['.doc', '.docx', '.xls', '.xlsx', '.pdf', '.svg', 'image/png', 'image/jpeg', 'image/gif', 'image/*', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'] : _ref$allowedExtension,\n      _ref$maxFileSize = _ref.maxFileSize,\n      maxFileSize = _ref$maxFileSize === void 0 ? 40000000 : _ref$maxFileSize,\n      disabled = _ref.disabled,\n      _ref$className = _ref.className,\n      className = _ref$className === void 0 ? '' : _ref$className,\n      render = _ref.render,\n      refreshCallback = _ref.refreshCallback,\n      uploadHandler = _ref.uploadHandler;\n\n  var _useState = useState(initialState),\n      state = _useState[0],\n      setState = _useState[1];\n\n  var _useState2 = useState(false),\n      runAutoUpload = _useState2[0],\n      setAutoUpload = _useState2[1];\n\n  var _useState3 = useState(false),\n      load = _useState3[0],\n      reload = _useState3[1];\n\n  function updateState(update) {\n    var newState = _objectSpread(_objectSpread({}, state), update);\n\n    setState(newState);\n    refreshCallback && refreshCallback(newState);\n    return newState;\n  }\n\n  var toast = {\n    warn: function warn(msg) {\n      toaster.warn(msg);\n      updateState({\n        error: msg\n      });\n    },\n    error: function error(msg) {\n      toaster.error(msg);\n      updateState({\n        error: msg\n      });\n    },\n    success: function success(msg) {\n      toaster.success(msg);\n      updateState({\n        error: ''\n      });\n    }\n  };\n\n  var checkMimeType = function checkMimeType(files, resetField) {\n    var err = [];\n    var types = allowedExtensions;\n\n    var _loop = function _loop(x) {\n      if (types.every(function (type) {\n        var _files$x;\n\n        return ((_files$x = files[x]) === null || _files$x === void 0 ? void 0 : _files$x.type) !== type;\n      })) {\n        err[x] = files[x].type + ' is not a supported format\\n';\n      }\n    };\n\n    for (var x = 0; x < files.length; x++) {\n      _loop(x);\n    }\n\n    for (var z = 0; z < err.length; z++) {\n      toast.error(err[z]);\n      resetField && resetField();\n    }\n\n    if (!isEmpty(err)) return false;\n    return true;\n  };\n\n  var maxSelectFile = function maxSelectFile(files, resetField) {\n    var maxLength = 1;\n\n    if (files.length > maxLength) {\n      var msg = \"Only \".concat(maxLength, \" file can be uploaded at a time\");\n      resetField && resetField();\n      toast.warn(msg);\n      return false;\n    }\n\n    return true;\n  };\n\n  var checkFileSize = function checkFileSize(files, resetField) {\n    //  default max size is 2.05GB\n    var size = maxFileSize || 20000000;\n    var err = [];\n\n    for (var x = 0; x < files.length; x++) {\n      if (files[x].size > size) {\n        err[x] = files[x].type + ' is too large, please pick a smaller file\\n' + \"Max size: \".concat(getFileSizeAndUnit(size));\n      }\n    }\n\n    for (var z = 0; z < err.length; z++) {\n      toast.error(err[z]);\n      resetField && resetField();\n    }\n\n    if (!isEmpty(err)) return false;\n    return true;\n  };\n\n  var readFile = function readFile(file) {\n    var currentIndex = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    var lState = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : state;\n    var validateFile = arguments.length > 3 ? arguments[3] : undefined;\n\n    // run validations if any\n    if (validateFile) {\n      validateFile(file);\n    }\n\n    var files = lState.files;\n    var reader = new FileReader();\n    reader.addEventListener('load', function (event) {\n      if (event.target) {\n        var filesData = {\n          url: event.target.result,\n          meta: Array.from(lState.selectedFile)[currentIndex],\n          loaded: files[currentIndex] ? files[currentIndex].loaded : 0\n        };\n        var newfileUpdate = files;\n        newfileUpdate[currentIndex] = filesData;\n        updateState({\n          files: newfileUpdate,\n          selectedFile: lState.selectedFile\n        });\n      }\n    });\n    reader.readAsDataURL(file);\n  };\n\n  var onChangeHandler = function onChangeHandler(event) {\n    var files = event.target.files;\n\n    var resetField = function resetField() {\n      return event.target.value = '';\n    };\n\n    if (files) {\n      if (maxSelectFile(files, resetField) && checkMimeType(files, resetField) && checkFileSize(files, resetField)) {\n        // if return true allow to setState\n        var newState = updateState({\n          selectedFile: files,\n          loaded: 0\n        });\n        Array.from(files).forEach(function (fl, index) {\n          return readFile(fl, index, newState);\n        });\n\n        if (autoUpload) {\n          setAutoUpload(true);\n        }\n      }\n    }\n  };\n\n  var handleUpload = function handleUpload(data, state, cb) {\n    if (uploadHandler) uploadHandler(data, state, cb);\n  };\n\n  var onClickHandler = function onClickHandler() {\n    var newState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : state;\n\n    try {\n      var selectedFile = newState.selectedFile;\n\n      var _data = new FormData();\n\n      if (!isEmpty(selectedFile)) {\n        for (var x = 0; x < selectedFile.length; x++) {\n          _data.append('file', selectedFile[x]);\n        }\n\n        handleUpload(_data, newState, updateState);\n      }\n    } catch (err) {\n      console.log('err', err);\n    } finally {\n      setAutoUpload(false);\n    }\n  };\n\n  var uploadArea = useRef(null);\n  var uploadDomRef = useRef(null);\n  var dc = useRef(null);\n  var uploadDom = '#common-upload-component';\n  useEffect(function () {\n    dc.current = document;\n    uploadArea.current = document.querySelector(uploadDom);\n    if (runAutoUpload) onClickHandler(state); // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [runAutoUpload, uploadDomRef.current]);\n\n  var getUploadArea = function getUploadArea() {\n    if (dc.current) return dc.current.querySelector(uploadDom);else if (uploadArea.current) return uploadArea.current;else if (uploadDomRef.current) return uploadDomRef.current;else if (!load) reload(true);\n  };\n\n  return __jsx(\"div\", {\n    id: \"drop-area\",\n    className: \"pt-4 relative \".concat(className),\n    style: {\n      minHeight: '50px'\n    }\n  }, __jsx(\"div\", {\n    className: \"container hidden\"\n  }, __jsx(\"div\", {\n    className: \"row\"\n  }, __jsx(\"div\", {\n    className: \"offset-md-3 col-md-6\"\n  }, __jsx(\"div\", {\n    className: \"form-group files\"\n  }, __jsx(\"label\", null, \"Upload Your File \"), __jsx(\"input\", {\n    type: \"file\",\n    id: \"common-upload-component\",\n    ref: uploadDomRef,\n    disabled: Boolean(disabled),\n    className: \"form-control\",\n    accept: \"xls, xlsx\",\n    onChange: onChangeHandler\n  })), !autoUpload && __jsx(\"button\", {\n    type: \"button\",\n    className: \"btn btn-success btn-block\",\n    onClick: function onClick() {\n      return onClickHandler();\n    }\n  }, \"Upload\")))), render(getUploadArea()));\n}","map":null,"metadata":{},"sourceType":"module"}